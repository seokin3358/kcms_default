<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Sidebar</title>
    <style>
        .admin-sidebar {
            width: 250px !important;
            height: 100vh !important;
            background-color: #2c3e50 !important;
            color: white !important;
            position: fixed !important;
            left: 0 !important;
            top: 0 !important;
            overflow-y: auto !important;
            z-index: 1000 !important;
            transition: all 0.3s ease !important;
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, 'Helvetica Neue', 'Segoe UI', 'Apple SD Gothic Neo', 'Noto Sans KR', 'Malgun Gothic', 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', sans-serif !important;
            font-size: 14px !important;
        }

        .admin-sidebar.collapsed {
            width: 60px;
        }

        .sidebar-header {
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid #34495e;
            background-color: #34495e;
        }

        .sidebar-header h3 {
            margin: 0 !important;
            font-size: 18px !important;
            font-weight: bold !important;
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, 'Helvetica Neue', 'Segoe UI', 'Apple SD Gothic Neo', 'Noto Sans KR', 'Malgun Gothic', 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', sans-serif !important;
            color: white !important;
        }

        .sidebar-header.collapsed h3 {
            display: none;
        }

        .sidebar-toggle {
            position: absolute;
            top: 20px;
            right: 10px;
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 5px;
        }

        .sidebar-toggle:hover {
            background-color: #34495e;
            border-radius: 3px;
        }

        .sidebar-menu {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .menu-item {
            border-bottom: 1px solid #34495e;
        }

        .menu-link {
            display: flex !important;
            align-items: center !important;
            padding: 15px 20px !important;
            color: #ecf0f1 !important;
            text-decoration: none !important;
            transition: all 0.3s ease !important;
            cursor: pointer !important;
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, 'Helvetica Neue', 'Segoe UI', 'Apple SD Gothic Neo', 'Noto Sans KR', 'Malgun Gothic', 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', sans-serif !important;
            font-size: 14px !important;
        }

        .menu-link:hover {
            background-color: #34495e;
            color: white;
        }

        .menu-link.active {
            background-color: #3498db;
            color: white;
        }

        .menu-icon {
            width: 20px !important;
            height: 20px !important;
            margin-right: 15px !important;
            font-size: 18px !important;
            text-align: center !important;
            color: inherit !important;
        }

        .menu-text {
            flex: 1 !important;
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, 'Helvetica Neue', 'Segoe UI', 'Apple SD Gothic Neo', 'Noto Sans KR', 'Malgun Gothic', 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', sans-serif !important;
            font-size: 14px !important;
            color: inherit !important;
        }

        /* ê³„ì¸µêµ¬ì¡° ì œê±°ë¡œ ì„œë¸Œë©”ë‰´ ê´€ë ¨ ìŠ¤íƒ€ì¼ ì œê±° */

        .collapsed .menu-text {
            display: none;
        }

        .collapsed .menu-link {
            justify-content: center;
            padding: 15px;
        }

        .collapsed .menu-icon {
            margin-right: 0;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .admin-sidebar {
                transform: translateX(-100%);
            }

            .admin-sidebar.mobile-open {
                transform: translateX(0);
            }
        }

        /* ë¡œë”© ìŠ¤í”¼ë„ˆ */
        .loading {
            text-align: center;
            padding: 20px;
            color: #bdc3c7;
        }

        .spinner {
            border: 2px solid #34495e;
            border-top: 2px solid #3498db;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="admin-sidebar" id="adminSidebar">
        <div class="sidebar-header" id="sidebarHeader">
            <h3>ì¼€ì´ì› ê´€ë¦¬ì</h3>
        </div>
        
        <ul class="sidebar-menu" id="sidebarMenu">
            <li class="loading">
                <div class="spinner"></div>
                ë©”ë‰´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
            </li>
        </ul>
    </div>

    <script>
        const API_BASE_URL = window.location.origin + '/api';
        let isCollapsed = false;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë©”ë‰´ ë¡œë“œ
        document.addEventListener('DOMContentLoaded', function() {
            loadAdminMenus();
            setActiveMenu();
        });

        // ì–´ë“œë¯¼ ë©”ë‰´ ë¡œë“œ (ê¶Œí•œ ê¸°ë°˜)
        async function loadAdminMenus() {
            try {
                const response = await fetch(`${API_BASE_URL}/admin-menus/accessible`, {
                    credentials: 'include'
                });
                
                if (response.ok) {
                    const menus = await response.json();
                    renderMenus(menus);
                } else {
                    console.error('Failed to load accessible menus, status:', response.status);
                    showError('ë©”ë‰´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. (ìƒíƒœ: ' + response.status + ')');
                }
            } catch (error) {
                console.error('Error loading accessible admin menus:', error);
                showError('ë©”ë‰´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ë©”ë‰´ ë Œë”ë§
        function renderMenus(menus) {
            const menuContainer = document.getElementById('sidebarMenu');
            
            if (!menuContainer) {
                console.error('Menu container not found!');
                return;
            }
            
            if (menus.length === 0) {
                menuContainer.innerHTML = '<li class="loading">ë“±ë¡ëœ ë©”ë‰´ê°€ ì—†ìŠµë‹ˆë‹¤.</li>';
                return;
            }

            menuContainer.innerHTML = menus.map(menu => `
                <li class="menu-item">
                    <a class="menu-link" 
                       href="${menu.menuUrl || '#'}" 
                       data-menu-id="${menu.menuNo}">
                        <span class="menu-icon">${getMenuIcon(menu.menuIcon)}</span>
                        <span class="menu-text">${menu.menuName}</span>
                    </a>
                </li>
            `).join('');

            // ë©”ë‰´ í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
            addMenuClickEvents();
        }

        // ë©”ë‰´ ì•„ì´ì½˜ ë§¤í•‘
        function getMenuIcon(iconName) {
            const iconMap = {
                'dashboard': 'ğŸ“Š',
                'content_copy': 'ğŸ“„',
                'people': 'ğŸ‘¥',
                'settings': 'âš™ï¸',
                'announcement': 'ğŸ“¢',
                'newspaper': 'ğŸ“°',
                'menu': 'ğŸ“‹',
                'admin_panel_settings': 'ğŸ‘¤',
                'tune': 'ğŸ›ï¸',
                'history': 'ğŸ“œ'
            };
            return iconMap[iconName] || 'ğŸ“';
        }

        // ê³„ì¸µêµ¬ì¡° ì œê±°ë¡œ ì„œë¸Œë©”ë‰´ í† ê¸€ í•¨ìˆ˜ ì œê±°

        // ë©”ë‰´ í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
        function addMenuClickEvents() {
            document.querySelectorAll('.menu-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    // URLì´ ìˆëŠ” ê²½ìš°ì—ë§Œ í˜ì´ì§€ ì´ë™
                    if (this.getAttribute('href') && this.getAttribute('href') !== '#') {
                        // í™œì„± ë©”ë‰´ ì„¤ì •
                        setActiveMenuItem(this);
                        
                        // í˜ì´ì§€ ì´ë™
                        window.location.href = this.getAttribute('href');
                    }
                });
            });
        }

        // í™œì„± ë©”ë‰´ ì„¤ì •
        function setActiveMenuItem(activeLink) {
            // ëª¨ë“  í™œì„± í´ë˜ìŠ¤ ì œê±°
            document.querySelectorAll('.menu-link.active').forEach(link => {
                link.classList.remove('active');
            });
            
            // í˜„ì¬ ë§í¬ì— í™œì„± í´ë˜ìŠ¤ ì¶”ê°€
            activeLink.classList.add('active');
        }

        // í˜„ì¬ í˜ì´ì§€ì— ë§ëŠ” í™œì„± ë©”ë‰´ ì„¤ì •
        function setActiveMenu() {
            const currentPath = window.location.pathname;
            
            document.querySelectorAll('.menu-link').forEach(link => {
                const href = link.getAttribute('href');
                if (href && currentPath.includes(href.replace('/admin/', ''))) {
                    setActiveMenuItem(link);
                }
            });
        }

        // ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ
        function showError(message) {
            const menuContainer = document.getElementById('sidebarMenu');
            menuContainer.innerHTML = `<li class="loading">${message}</li>`;
        }

        // ì „ì—­ í•¨ìˆ˜ë¡œ ë…¸ì¶œ
        window.toggleSidebar = toggleSidebar;
        window.toggleMobileSidebar = toggleMobileSidebar;
    </script>
</body>
</html>
