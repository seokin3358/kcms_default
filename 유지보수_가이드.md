# KITMS 프로젝트 유지보수 가이드

## 📋 프로젝트 개요

**KITMS (Key IT Management System)**는 케이원의 IT 관리 시스템으로, JHipster 8.1.0 기반의 Spring Boot 애플리케이션입니다.

### 기술 스택
- **Backend**: Spring Boot 3.2.0, Java 17, JHipster 8.1.0
- **Database**: MariaDB
- **Frontend**: Vanilla JavaScript, HTML5, CSS3
- **Build Tool**: Maven 3.2.5
- **Node.js**: v18.18.2 (빌드용)

---

## 🚀 개발 환경 설정

### 1. 필수 요구사항
```bash
# Java 17 설치 확인
java -version

# Node.js 18.18.2 설치 확인
node -v

# Maven 3.2.5 설치 확인
mvn -v
```

### 2. 데이터베이스 설정
```sql
-- MariaDB 데이터베이스 생성
CREATE DATABASE kitms CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- 사용자 생성 및 권한 부여
CREATE USER 'kitms'@'localhost' IDENTIFIED BY 'kitms123!';
GRANT ALL PRIVILEGES ON kitms.* TO 'kitms'@'localhost';
FLUSH PRIVILEGES;
```

### 3. 애플리케이션 실행
```bash
# 개발 모드 실행
./mvnw spring-boot:run

# 프로덕션 빌드
./mvnw -Pprod clean package

# 프로덕션 실행
java -jar target/kitms-0.0.1-SNAPSHOT.jar
```

---

## 🏗️ 프로젝트 구조

### 주요 디렉토리
```
src/
├── main/
│   ├── java/com/kone/kitms/
│   │   ├── domain/          # JPA 엔티티
│   │   ├── repository/      # 데이터 접근 계층
│   │   ├── service/         # 비즈니스 로직
│   │   ├── web/rest/        # REST API 컨트롤러
│   │   ├── web/controller/  # 뷰 컨트롤러
│   │   └── config/          # 설정 클래스
│   └── resources/
│       ├── static/          # 정적 파일 (HTML, CSS, JS, 이미지)
│       ├── templates/       # Thymeleaf 템플릿
│       └── db/migration/    # Liquibase 마이그레이션
└── test/                    # 테스트 코드
```

### 핵심 엔티티
- **KitmsUser**: 사용자 관리
- **KitmsNotice**: 공지사항
- **KitmsNewsroom**: 뉴스룸
- **KitmsMenu**: 메뉴 관리
- **AdminMenu**: 관리자 메뉴
- **KitmsAttach**: 파일 첨부

---

## 🔧 주요 기능 및 API

### 1. 사용자 관리 (`/api/kitms-users`)
- `GET /all`: 모든 사용자 조회
- `GET /{userId}`: 특정 사용자 조회
- `POST /`: 새 사용자 생성
- `PUT /`: 사용자 수정
- `DELETE /{userId}`: 사용자 삭제
- `GET /current`: 현재 로그인 사용자 정보

### 2. 공지사항 관리 (`/api/kitms-notices`)
- `GET /`: 공지사항 목록 조회
- `GET /{noticeNo}`: 특정 공지사항 조회
- `POST /`: 새 공지사항 생성
- `PUT /{noticeNo}`: 공지사항 수정
- `DELETE /{noticeNo}`: 공지사항 삭제

### 3. 뉴스룸 관리 (`/api/kitms-newsrooms`)
- `GET /`: 뉴스룸 목록 조회
- `POST /`: 새 뉴스룸 생성
- `PUT /{newsroomNo}`: 뉴스룸 수정
- `DELETE /{newsroomNo}`: 뉴스룸 삭제

### 4. 보안 이미지 관리 (`/api/secure-images`)
- `GET /{token}`: 토큰으로 이미지 제공
- `POST /session-token`: 세션 토큰 발급
- `GET /generate/{fileName}`: 특정 파일용 토큰 생성
- `POST /refresh`: 모든 이미지 토큰 새로고침

---

## 🛡️ 보안 기능

### 1. 이미지 보안 시스템
- **토큰 기반 접근**: 모든 이미지는 토큰을 통해서만 접근 가능
- **자동 만료**: 이미지 토큰은 2시간, 세션 토큰은 2시간 후 만료
- **자동 재생성**: 410 에러 발생 시 자동으로 새 토큰 생성
- **접근 제한**: User-Agent, Accept 헤더 검증

### 2. 인증 및 권한
- **JWT 토큰**: 로그인 시 JWT 토큰 발급
- **권한 코드**: 001(메인관리자), 002(서브관리자)
- **토큰 검증**: `@ExTokenCheck` 어노테이션으로 API 보호

---

## 🐛 최근 해결된 문제

### 410 에러 (Gone) 해결
**문제**: 이미지 토큰 만료로 인한 410 에러 발생

**해결책**:
1. **토큰 만료 시간 연장**: 30분 → 2시간
2. **자동 토큰 재생성**: 410 에러 시 302 리다이렉트로 새 토큰 제공
3. **프론트엔드 에러 처리**: 이미지 로딩 실패 시 자동 재시도 (최대 2회)

**관련 파일**:
- `SecureImageController.java`: 백엔드 토큰 관리
- `main.html`: 프론트엔드 에러 처리

---

## 📝 유지보수 체크리스트

### 정기 점검사항
- [ ] 데이터베이스 연결 상태 확인
- [ ] 이미지 토큰 만료 시간 모니터링
- [ ] 로그 파일 크기 확인 (`~/var/kitms/log/`)
- [ ] 메모리 사용량 모니터링
- [ ] 백업 상태 확인

### 문제 발생 시 확인사항
1. **이미지 로딩 문제**:
   - 토큰 만료 여부 확인
   - `SecureImageController` 로그 확인
   - 브라우저 개발자 도구에서 네트워크 탭 확인

2. **로그인 문제**:
   - JWT 토큰 유효성 확인
   - 데이터베이스 사용자 테이블 상태 확인
   - 세션 설정 확인

3. **API 오류**:
   - `ExceptionTranslator.java`에서 에러 처리 확인
   - 로그 파일에서 스택 트레이스 확인

---

## 🔄 배포 가이드

### 개발 환경 배포
```bash
# 1. 코드 업데이트
git pull origin main

# 2. 의존성 업데이트
./mvnw clean install

# 3. 애플리케이션 재시작
./mvnw spring-boot:run
```

### 프로덕션 환경 배포
```bash
# 1. 프로덕션 빌드
./mvnw -Pprod clean package

# 2. 기존 애플리케이션 중지
pkill -f kitms

# 3. 새 버전 배포
java -jar target/kitms-0.0.1-SNAPSHOT.jar --spring.profiles.active=prod

# 4. 로그 확인
tail -f ~/var/kitms/log/kitms_server_log.log
```

---

## 📞 연락처 및 지원

### 개발팀 연락처
- **프로젝트 관리자**: [연락처 정보]
- **백엔드 개발자**: [연락처 정보]
- **프론트엔드 개발자**: [연락처 정보]

### 유용한 링크
- **JHipster 문서**: https://www.jhipster.tech/documentation-archive/v8.1.0
- **Spring Boot 문서**: https://spring.io/projects/spring-boot
- **MariaDB 문서**: https://mariadb.org/documentation/

---

## 📋 추가 개발 사항

### 완료된 기능
- ✅ 공지사항 관리 (이미지 포함)
- ✅ 사용자 관리
- ✅ 뉴스룸 관리
- ✅ 메뉴 관리
- ✅ 이미지 보안 시스템
- ✅ 권한 관리

### 향후 개발 예정
- 🔄 채용공고 연결
- 🔄 구글 맵 연동
- 🔄 CKEditor 한글폰트 추가
- 🔄 경로 변경 (`http://localhost:8080` → 실제 도메인)

---

**마지막 업데이트**: 2025년 1월 26일
**문서 버전**: 1.0

