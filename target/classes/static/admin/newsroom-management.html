<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë³´ë„ìë£Œ ê´€ë¦¬ - ì¼€ì´ì› ê´€ë¦¬ì</title>
    <link rel="icon" href="../images/ico.ico" type="image/x-icon">
    <!-- ê¶Œí•œ ì²´í¬ ìŠ¤í¬ë¦½íŠ¸ -->
    <script src="../common/admin-permission.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, 'Helvetica Neue', 'Segoe UI', 'Apple SD Gothic Neo', 'Noto Sans KR', 'Malgun Gothic', 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', sans-serif;
            background-color: #f8f9fa;
            color: #333;
        }

        .admin-container {
            display: flex;
            min-height: 100vh;
        }

        /* ë©”ì¸ ì½˜í…ì¸  */
        .main-content {
            flex: 1;
            margin-left: 250px;
            padding: 20px;
            transition: margin-left 0.3s ease;
        }

        .main-content.sidebar-collapsed {
            margin-left: 60px;
        }

        /* ëª¨ë°”ì¼ ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .main-content {
                margin-left: 0;
            }
            
            .main-content.sidebar-collapsed {
                margin-left: 0;
            }
        }
        
        .header {
            background: white;
            padding: 20px 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title {
            font-size: 24px;
            font-weight: 700;
            color: #333;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-name {
            font-size: 14px;
            color: #666;
        }

        .logout-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s ease;
        }

        .logout-btn:hover {
            background: #c82333;
        }

        /* ë©”ì‹œì§€ ì»¨í…Œì´ë„ˆ */
        .message-container {
            margin-bottom: 20px;
        }

        .message-container .alert {
            padding: 12px 20px;
            border-radius: 6px;
            margin-bottom: 10px;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: space-between;
            animation: slideDown 0.3s ease-out;
        }

        .message-container .alert.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .message-container .alert.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .message-container .alert .close-btn {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            color: inherit;
            opacity: 0.7;
            padding: 0;
            margin-left: 10px;
        }

        .message-container .alert .close-btn:hover {
            opacity: 1;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ì½˜í…ì¸  ì¹´ë“œ */
        .content-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 30px;
        }

        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e9ecef;
        }

        .content-title {
            font-size: 20px;
            font-weight: 600;
            color: #333;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }
        
        .btn-primary {
            background-color: #007bff;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #0056b3;
        }
        
        .btn-success {
            background-color: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background-color: #1e7e34;
        }
        
        .btn-warning {
            background-color: #ffc107;
            color: #212529;
        }
        
        .btn-warning:hover {
            background-color: #e0a800;
        }
        
        .btn-danger {
            background-color: #dc3545;
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #c82333;
        }
        
        .btn-sm {
            padding: 5px 10px;
            font-size: 12px;
        }
        
        .search-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .search-form {
            display: flex;
            gap: 10px;
            align-items: end;
        }
        
        .form-group {
            flex: 1;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        
        .form-control {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
        }

        /* ì´ë¯¸ì§€ ì—…ë¡œë“œ ê´€ë ¨ ìŠ¤íƒ€ì¼ */
        .image-upload-container {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            background-color: #f9f9f9;
        }

        .image-upload-container:hover {
            border-color: #007bff;
            background-color: #f0f8ff;
        }

        .image-preview, .current-image {
            margin-top: 15px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: white;
        }

        .image-preview img, .current-image img {
            max-width: 200px;
            max-height: 150px;
            border-radius: 5px;
            margin-bottom: 10px;
        }

        .current-image span {
            display: block;
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }

        /* í…Œì´ë¸” ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° ìŠ¤íƒ€ì¼ */
        .table img {
            width: 50px;
            height: 40px;
            object-fit: cover;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        
        .table-container {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .table th,
        .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }
        
        .table th {
            background-color: #f8f9fa;
            font-weight: bold;
            color: #555;
        }
        
        .table tbody tr:hover {
            background-color: #f8f9fa;
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status-active {
            background-color: #d4edda;
            color: #155724;
        }
        
        .status-inactive {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .featured-badge {
            background-color: #fff3cd;
            color: #856404;
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 10px;
            margin-left: 5px;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
            gap: 10px;
        }
        
        .pagination button {
            padding: 8px 12px;
            border: 1px solid #ddd;
            background: white;
            cursor: pointer;
            border-radius: 4px;
        }
        
        .pagination button:hover {
            background-color: #f8f9fa;
        }
        
        .pagination button.active {
            background-color: #007bff;
            color: white;
            border-color: #007bff;
        }
        
        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 8px;
            width: 80%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e9ecef;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: bold;
            color: #333;
        }
        
        .close {
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            color: #aaa;
        }
        
        .close:hover {
            color: #000;
        }
        
        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #e9ecef;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        
        .error {
            color: #dc3545;
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        
        .success {
            color: #155724;
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- ê³µí†µ ì‚¬ì´ë“œë°” ë¡œë“œ -->
        <div id="adminSidebarContainer"></div>

        <!-- ë©”ì¸ ì½˜í…ì¸  -->
        <main class="main-content">
            <!-- í˜ì´ì§€ í—¤ë” -->
            <div class="header">
                <h1 class="header-title">ë³´ë„ìë£Œ ê´€ë¦¬</h1>
                <div class="user-info">
                    <span class="user-name">ê´€ë¦¬ì</span>
                    <button class="logout-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
            </div>

            <!-- ë©”ì‹œì§€ í‘œì‹œ ì˜ì—­ -->
            <div id="messageContainer" class="message-container"></div>

            <!-- ì½˜í…ì¸  ì¹´ë“œ -->
            <div class="content-card">
                <div class="content-header">
                    <h2 class="content-title">ë³´ë„ìë£Œ ëª©ë¡</h2>
                    <button class="btn btn-primary" onclick="openCreateModal()">
                        ìƒˆ ë³´ë„ìë£Œ ì‘ì„±
                    </button>
                </div>

        <!-- ê²€ìƒ‰ ì„¹ì…˜ -->
        <div class="search-section">
            <form class="search-form" onsubmit="searchNewsrooms(event)">
                <div class="form-group">
                    <label for="searchKeyword">ê²€ìƒ‰ì–´</label>
                    <input type="text" id="searchKeyword" class="form-control" placeholder="ì œëª©ìœ¼ë¡œ ê²€ìƒ‰í•˜ì„¸ìš”">
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">ê²€ìƒ‰</button>
                    <button type="button" class="btn btn-secondary" onclick="resetSearch()">ì´ˆê¸°í™”</button>
                </div>
            </form>
        </div>

        <!-- ë³´ë„ìë£Œ ëª©ë¡ -->
        <div class="table-container">
            <table class="table">
                <thead>
                    <tr>
                        <th>ë²ˆí˜¸</th>
                        <th>ì œëª©</th>
                        <th>ë§í¬</th>
                        <th>ì´ë¯¸ì§€</th>
                        <th>ìƒíƒœ</th>
                        <th>ë“±ë¡ì¼</th>
                        <th>ìµœì¢…ìˆ˜ì •ì¼</th>
                        <th>ê´€ë¦¬</th>
                    </tr>
                </thead>
                <tbody id="newsroomList">
                    <tr>
                        <td colspan="8" class="loading">ë³´ë„ìë£Œ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
        <div class="pagination" id="pagination">
            <!-- í˜ì´ì§€ë„¤ì´ì…˜ ë²„íŠ¼ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
        </div>
    </div>

    <!-- ë³´ë„ìë£Œ ì‘ì„±/ìˆ˜ì • ëª¨ë‹¬ -->
    <div id="newsroomModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">ìƒˆ ë³´ë„ìë£Œ ì‘ì„±</h2>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            
            <form id="newsroomForm" onsubmit="saveNewsroom(event)">
                <div class="form-group">
                    <label for="newsroomTitle">ì œëª© *</label>
                    <input type="text" id="newsroomTitle" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="newsroomUrl">ë§í¬ *</label>
                    <input type="url" id="newsroomUrl" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="newsroomImage">ì´ë¯¸ì§€</label>
                    <div class="image-upload-container">
                        <input type="file" id="newsroomImage" class="form-control" accept="image/*" onchange="handleImageUpload(event)">
                        <div class="image-preview" id="imagePreview" style="display: none;">
                            <img id="previewImg" src="" alt="ë¯¸ë¦¬ë³´ê¸°">
                            <button type="button" class="btn btn-sm btn-danger" onclick="removeImage()">ì œê±°</button>
                        </div>
                        <div class="current-image" id="currentImage" style="display: none;">
                            <span>í˜„ì¬ ì´ë¯¸ì§€:</span>
                            <img id="currentImg" src="" alt="í˜„ì¬ ì´ë¯¸ì§€">
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="newsroomStatus">ìƒíƒœ</label>
                    <select id="newsroomStatus" class="form-control">
                        <option value="ACTIVE">í™œì„±</option>
                        <option value="INACTIVE">ë¹„í™œì„±</option>
                    </select>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">ì·¨ì†Œ</button>
                    <button type="submit" class="btn btn-primary">ì €ì¥</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const API_BASE_URL = '/api';
        let currentPage = 0;
        let currentSearchType = '';
        let currentSearchKeyword = '';
        let editingNewsroomId = null;
        let uploadedImageFile = null;
        let currentImagePath = null;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            loadNewsrooms();
        });

        // ë³´ë„ìë£Œ ëª©ë¡ ë¡œë“œ
        async function loadNewsrooms(page = 0) {
            try {
                currentPage = page;
                const response = await fetch(`${API_BASE_URL}/newsrooms?page=${page}&size=10&sort=createdAt,desc`);
                const pageData = await response.json();
                
                if (response.ok) {
                    displayNewsrooms(pageData.content);
                    displayPagination(pageData);
                } else {
                    showError('ë³´ë„ìë£Œ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('Error loading newsrooms:', error);
                showError('ë³´ë„ìë£Œ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ë³´ë„ìë£Œ ëª©ë¡ í‘œì‹œ
        function displayNewsrooms(newsrooms) {
            const tbody = document.getElementById('newsroomList');
            
            if (newsrooms.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="text-center">ë“±ë¡ëœ ë³´ë„ìë£Œê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                return;
            }
            
            tbody.innerHTML = newsrooms.map((newsroom, index) => `
                <tr>
                    <td>${index + 1}</td>
                    <td>${newsroom.newsroomTitle}</td>
                    <td><a href="${newsroom.newsroomUrl}" target="_blank" style="color: #007bff;">ë§í¬</a></td>
                    <td>
                        ${newsroom.newsroomImage ? 
                            `<img src="${newsroom.newsroomImage.startsWith('/images/') ? newsroom.newsroomImage : '/images/' + newsroom.newsroomImage}" 
                                 alt="ì´ë¯¸ì§€" 
                                 onerror="tryAlternativePaths(this, '${newsroom.newsroomImage}')">
                             <span style="display:none; color: #999; font-size: 12px;">ì´ë¯¸ì§€ ì—†ìŒ</span>` : 
                            '<span style="color: #999; font-size: 12px;">ì´ë¯¸ì§€ ì—†ìŒ</span>'
                        }
                    </td>
                    <td>
                        <span class="status-badge ${newsroom.newsroomStatus === 'ACTIVE' ? 'status-active' : 'status-inactive'}">
                            ${newsroom.newsroomStatus === 'ACTIVE' ? 'í™œì„±' : 'ë¹„í™œì„±'}
                        </span>
                    </td>
                    <td>${formatDate(newsroom.createdAt)}</td>
                    <td>${formatDate(newsroom.updatedAt)}</td>
                    <td>
                        <button class="btn btn-warning btn-sm" onclick="editNewsroom(${newsroom.newsroomNo})">ìˆ˜ì •</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteNewsroom(${newsroom.newsroomNo})">ì‚­ì œ</button>
                    </td>
                </tr>
            `).join('');
        }

        // í˜ì´ì§€ë„¤ì´ì…˜ í‘œì‹œ
        function displayPagination(pageData) {
            const pagination = document.getElementById('pagination');
            const totalPages = pageData.totalPages;
            const currentPageNum = pageData.number;
            
            let paginationHTML = '';
            
            // ì´ì „ í˜ì´ì§€ ë²„íŠ¼
            paginationHTML += `
                <button ${currentPageNum === 0 ? 'disabled' : ''} onclick="loadNewsrooms(${currentPageNum - 1})">
                    ì´ì „
                </button>
            `;
            
            // í˜ì´ì§€ ë²ˆí˜¸ ë²„íŠ¼ë“¤
            for (let i = 0; i < totalPages; i++) {
                paginationHTML += `
                    <button class="${i === currentPageNum ? 'active' : ''}" onclick="loadNewsrooms(${i})">
                        ${i + 1}
                    </button>
                `;
            }
            
            // ë‹¤ìŒ í˜ì´ì§€ ë²„íŠ¼
            paginationHTML += `
                <button ${currentPageNum === totalPages - 1 ? 'disabled' : ''} onclick="loadNewsrooms(${currentPageNum + 1})">
                    ë‹¤ìŒ
                </button>
            `;
            
            pagination.innerHTML = paginationHTML;
        }

        // ê²€ìƒ‰
        async function searchNewsrooms(event) {
            event.preventDefault();
            
            const searchKeyword = document.getElementById('searchKeyword').value.trim();
            
            if (!searchKeyword) {
                loadNewsrooms();
                return;
            }
            
            currentSearchType = 'title';
            currentSearchKeyword = searchKeyword;
            
            try {
                const response = await fetch(`${API_BASE_URL}/newsrooms/search/title?title=${encodeURIComponent(searchKeyword)}&page=0&size=10`);
                const pageData = await response.json();
                
                if (response.ok) {
                    displayNewsrooms(pageData.content);
                    displayPagination(pageData);
                } else {
                    showError('ê²€ìƒ‰ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('Error searching newsrooms:', error);
                showError('ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ê²€ìƒ‰ ì´ˆê¸°í™”
        function resetSearch() {
            document.getElementById('searchKeyword').value = '';
            currentSearchType = '';
            currentSearchKeyword = '';
            loadNewsrooms();
        }

        // ìƒˆ ë³´ë„ìë£Œ ì‘ì„± ëª¨ë‹¬ ì—´ê¸°
        function openCreateModal() {
            editingNewsroomId = null;
            uploadedImageFile = null;
            currentImagePath = null;
            originalNewsroomData = null; // ê¸°ì¡´ ë°ì´í„° ì´ˆê¸°í™”
            
            document.getElementById('modalTitle').textContent = 'ìƒˆ ë³´ë„ìë£Œ ì‘ì„±';
            document.getElementById('newsroomForm').reset();
            document.getElementById('currentImage').style.display = 'none';
            document.getElementById('imagePreview').style.display = 'none';
            document.getElementById('newsroomModal').style.display = 'block';
        }

        // ê¸°ì¡´ ë³´ë„ìë£Œ ë°ì´í„° ì €ì¥ìš© ë³€ìˆ˜
        let originalNewsroomData = null;

        // ë³´ë„ìë£Œ ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸°
        async function editNewsroom(newsroomId) {
            try {
                const response = await fetch(`${API_BASE_URL}/newsrooms/${newsroomId}`);
                
                if (response.ok) {
                    const newsroom = await response.json();
                    editingNewsroomId = newsroomId;
                    
                    // ê¸°ì¡´ ë°ì´í„° ì €ì¥ (created_by, created_at ë³´ì¡´ìš©)
                    originalNewsroomData = {
                        createdBy: newsroom.createdBy,
                        createdAt: newsroom.createdAt
                    };
                    
                    document.getElementById('modalTitle').textContent = 'ë³´ë„ìë£Œ ìˆ˜ì •';
                    document.getElementById('newsroomTitle').value = newsroom.newsroomTitle || '';
                    document.getElementById('newsroomUrl').value = newsroom.newsroomUrl || '';
                    document.getElementById('newsroomStatus').value = newsroom.newsroomStatus || 'ACTIVE';
                    
                    // ì´ë¯¸ì§€ ì²˜ë¦¬
                    uploadedImageFile = null;
                    if (newsroom.newsroomImage) {
                        showCurrentImage(newsroom.newsroomImage);
                    } else {
                        document.getElementById('currentImage').style.display = 'none';
                        document.getElementById('imagePreview').style.display = 'none';
                    }
                    
                    document.getElementById('newsroomModal').style.display = 'block';
                } else {
                    showError('ë³´ë„ìë£Œ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('Error loading newsroom:', error);
                showError('ë³´ë„ìë£Œ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ë³´ë„ìë£Œ ì €ì¥
        async function saveNewsroom(event) {
            event.preventDefault();
            
            try {
                let imagePath = currentImagePath; // ê¸°ì¡´ ì´ë¯¸ì§€ ê²½ë¡œ ìœ ì§€
                
                // ìƒˆ ì´ë¯¸ì§€ê°€ ì—…ë¡œë“œëœ ê²½ìš°
                if (uploadedImageFile) {
                    const uploadFormData = new FormData();
                    uploadFormData.append('file', uploadedImageFile);
                    uploadFormData.append('tableName', 'KITMS_NEWSROOM');
                    uploadFormData.append('tablePk', 'temp'); // í•­ìƒ tempë¡œ ì „ì†¡
                    
                    const uploadResponse = await fetch(`${API_BASE_URL}/kitms-attaches/upload-file`, {
                        method: 'POST',
                        body: uploadFormData
                    });
                    
                    if (uploadResponse.ok) {
                        const uploadResult = await uploadResponse.json();
                        // ì„ì‹œ íŒŒì¼ì˜ ê²½ìš° filePathë¥¼ ì‚¬ìš© (ì „ì²´ ê²½ë¡œ)
                        imagePath = uploadResult.data.filePath;
                    } else {
                        const errorResult = await uploadResponse.json();
                        showError('ì´ë¯¸ì§€ ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + (errorResult.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                        return;
                    }
                }
                
                const formData = {
                    newsroomTitle: document.getElementById('newsroomTitle').value,
                    newsroomUrl: document.getElementById('newsroomUrl').value,
                    newsroomImage: imagePath,
                    newsroomStatus: document.getElementById('newsroomStatus').value
                };
                
                // ìˆ˜ì • ëª¨ë“œì¸ ê²½ìš° newsroomNoì™€ ê¸°ì¡´ ë°ì´í„° ì¶”ê°€
                if (editingNewsroomId) {
                    formData.newsroomNo = editingNewsroomId;
                    // ê¸°ì¡´ ë°ì´í„° ë³´ì¡´
                    if (originalNewsroomData) {
                        formData.createdBy = originalNewsroomData.createdBy;
                        formData.createdAt = originalNewsroomData.createdAt;
                    }
                }
                
                const url = editingNewsroomId ? 
                    `${API_BASE_URL}/newsrooms/${editingNewsroomId}` : 
                    `${API_BASE_URL}/newsrooms`;
                
                const method = editingNewsroomId ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });
                
                if (response.ok) {
                    showSuccess(editingNewsroomId ? 'ë³´ë„ìë£Œê°€ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.' : 'ë³´ë„ìë£Œê°€ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    closeModal();
                    loadNewsrooms(currentPage);
                } else {
                    const errorResult = await response.json();
                    showError('ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + (errorResult.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                }
            } catch (error) {
                console.error('Error saving newsroom:', error);
                showError('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ë³´ë„ìë£Œ ì‚­ì œ
        async function deleteNewsroom(newsroomId) {
            if (!confirm('ì •ë§ë¡œ ì´ ë³´ë„ìë£Œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/newsrooms/${newsroomId}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    showSuccess('ë³´ë„ìë£Œê°€ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    loadNewsrooms(currentPage);
                } else {
                    showError('ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('Error deleting newsroom:', error);
                showError('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ëª¨ë‹¬ ë‹«ê¸°
        function closeModal() {
            document.getElementById('newsroomModal').style.display = 'none';
            editingNewsroomId = null;
        }

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        window.onclick = function(event) {
            const modal = document.getElementById('newsroomModal');
            if (event.target === modal) {
                closeModal();
            }
        }

        // ë‚ ì§œ í¬ë§·íŒ…
        function formatDate(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleDateString('ko-KR') + ' ' + date.toLocaleTimeString('ko-KR', {hour: '2-digit', minute: '2-digit'});
        }

        // ì´ë¯¸ì§€ ì—…ë¡œë“œ ì²˜ë¦¬
        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            // íŒŒì¼ í¬ê¸° ì²´í¬ (5MB ì œí•œ)
            if (file.size > 5 * 1024 * 1024) {
                showError('ì´ë¯¸ì§€ íŒŒì¼ í¬ê¸°ëŠ” 5MBë¥¼ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                event.target.value = '';
                return;
            }

            // íŒŒì¼ íƒ€ì… ì²´í¬
            if (!file.type.startsWith('image/')) {
                showError('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                event.target.value = '';
                return;
            }

            uploadedImageFile = file;
            currentImagePath = null; // ìƒˆ ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹œ ê¸°ì¡´ ì´ë¯¸ì§€ ê²½ë¡œ ì´ˆê¸°í™”

            // ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
            const reader = new FileReader();
            reader.onload = function(e) {
                const previewImg = document.getElementById('previewImg');
                const imagePreview = document.getElementById('imagePreview');
                const currentImage = document.getElementById('currentImage');
                
                previewImg.src = e.target.result;
                imagePreview.style.display = 'block';
                currentImage.style.display = 'none';
            };
            reader.readAsDataURL(file);
        }

        // ì´ë¯¸ì§€ ì œê±°
        function removeImage() {
            uploadedImageFile = null;
            currentImagePath = null;
            
            const imagePreview = document.getElementById('imagePreview');
            const currentImage = document.getElementById('currentImage');
            const fileInput = document.getElementById('newsroomImage');
            
            imagePreview.style.display = 'none';
            currentImage.style.display = 'none';
            fileInput.value = '';
        }

        // ì´ë¯¸ì§€ URL ìƒì„± í•¨ìˆ˜
        function getImageUrl(imagePath) {
            if (!imagePath) return '';
            
            // ì´ë¯¸ ì „ì²´ ê²½ë¡œì¸ ê²½ìš°
            if (imagePath.startsWith('/images/')) {
                return imagePath;
            }
            
            // íŒŒì¼ëª…ë§Œ ìˆëŠ” ê²½ìš° - ê¸°ë³¸ ê²½ë¡œ ë°˜í™˜ (ì‹¤ì œ ê²½ë¡œëŠ” onerrorì—ì„œ ì²˜ë¦¬)
            return `/images/${imagePath}`;
        }

        // ëŒ€ì²´ ê²½ë¡œë“¤ì„ ì‹œë„í•˜ëŠ” í•¨ìˆ˜
        function tryAlternativePaths(imgElement, fileName) {
            // ë°±ì—”ë“œ APIë¥¼ í†µí•´ ì‹¤ì œ íŒŒì¼ ê²½ë¡œ ì°¾ê¸°
            fetch(`${API_BASE_URL}/kitms-attaches/find-image/${fileName}`)
                .then(response => response.json())
                .then(result => {
                    if (result.statusCode === 200 && result.data.filePath) {
                        imgElement.src = result.data.filePath;
                    } else {
                        // APIì—ì„œ íŒŒì¼ì„ ì°¾ì§€ ëª»í•œ ê²½ìš° ì´ë¯¸ì§€ ìˆ¨ê¸°ê¸°
                        imgElement.style.display = 'none';
                        const span = imgElement.nextElementSibling;
                        if (span) {
                            span.style.display = 'inline';
                        }
                    }
                })
                .catch(error => {
                    console.error('ì´ë¯¸ì§€ ê²½ë¡œ ì°¾ê¸° ì˜¤ë¥˜:', error);
                    // ì˜¤ë¥˜ ë°œìƒ ì‹œ ì´ë¯¸ì§€ ìˆ¨ê¸°ê¸°
                    imgElement.style.display = 'none';
                    const span = imgElement.nextElementSibling;
                    if (span) {
                        span.style.display = 'inline';
                    }
                });
        }

        // í˜„ì¬ ì´ë¯¸ì§€ í‘œì‹œ (ìˆ˜ì • ëª¨ë“œì—ì„œ)
        function showCurrentImage(imagePath) {
            if (!imagePath) return;
            
            currentImagePath = imagePath;
            const currentImg = document.getElementById('currentImg');
            const currentImage = document.getElementById('currentImage');
            const imagePreview = document.getElementById('imagePreview');
            
            // ì´ë¯¸ì§€ URL ìƒì„± ë° onerror ì´ë²¤íŠ¸ ì„¤ì •
            currentImg.src = getImageUrl(imagePath);
            currentImg.onerror = function() {
                // ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨ ì‹œ ë°±ì—”ë“œ APIë¡œ ì‹¤ì œ ê²½ë¡œ ì°¾ê¸°
                tryAlternativePaths(this, imagePath);
            };
            
            currentImage.style.display = 'block';
            imagePreview.style.display = 'none';
        }

        // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
        function showSuccess(message) {
            const messageContainer = document.getElementById('messageContainer');
            if (!messageContainer) return;
            
            const alertDiv = document.createElement('div');
            alertDiv.className = 'alert success';
            alertDiv.innerHTML = `
                <span>${message}</span>
                <button class="close-btn" onclick="this.parentElement.remove()">&times;</button>
            `;
            
            messageContainer.appendChild(alertDiv);
            
            setTimeout(() => {
                if (alertDiv.parentElement) {
                    alertDiv.remove();
                }
            }, 5000);
        }

        // ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ
        function showError(message) {
            const messageContainer = document.getElementById('messageContainer');
            if (!messageContainer) return;
            
            const alertDiv = document.createElement('div');
            alertDiv.className = 'alert error';
            alertDiv.innerHTML = `
                <span>${message}</span>
                <button class="close-btn" onclick="this.parentElement.remove()">&times;</button>
            `;
            
            messageContainer.appendChild(alertDiv);
            
            setTimeout(() => {
                if (alertDiv.parentElement) {
                    alertDiv.remove();
                }
            }, 7000);
        }

        function logout() {
            window.location.href = '/admin/logout';
        }

        // ê³µí†µ ì‚¬ì´ë“œë°” ë¡œë“œ
        async function loadAdminSidebar() {
            try {
                const response = await fetch('/admin/common/admin-sidebar.html');
                if (response.ok) {
                    const sidebarHTML = await response.text();
                    const container = document.getElementById('adminSidebarContainer');
                    if (container) {
                        container.innerHTML = sidebarHTML;
                        
                        // ì‚¬ì´ë“œë°” ë¡œë“œ í›„ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
                        setupSidebarEvents();
                        
                        // ë©”ë‰´ ë¡œë“œ
                        loadAdminMenus();
                    } else {
                        console.error('Admin sidebar container not found');
                    }
                } else {
                    console.error('Failed to load admin sidebar, status:', response.status);
                }
            } catch (error) {
                console.error('Error loading admin sidebar:', error);
            }
        }

        // ì–´ë“œë¯¼ ë©”ë‰´ ë¡œë“œ
        async function loadAdminMenus() {
            try {
                const response = await fetch(`${window.location.origin}/api/admin-menus/active`);
                
                if (response.ok) {
                    const menus = await response.json();
                    renderMenus(menus);
                } else {
                    console.error('Failed to load menus, status:', response.status);
                    showMenuError('ë©”ë‰´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. (ìƒíƒœ: ' + response.status + ')');
                }
            } catch (error) {
                console.error('Error loading admin menus:', error);
                showMenuError('ë©”ë‰´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ë©”ë‰´ ë Œë”ë§
        function renderMenus(menus) {
            const menuContainer = document.getElementById('sidebarMenu');
            
            if (!menuContainer) {
                console.error('Menu container not found!');
                return;
            }
            
            if (menus.length === 0) {
                menuContainer.innerHTML = '<li class="loading">ë“±ë¡ëœ ë©”ë‰´ê°€ ì—†ìŠµë‹ˆë‹¤.</li>';
                return;
            }

            menuContainer.innerHTML = menus.map(menu => `
                <li class="menu-item">
                    <a class="menu-link" 
                       href="${menu.menuUrl || '#'}" 
                       data-menu-id="${menu.menuNo}">
                        <span class="menu-icon">${getMenuIcon(menu.menuIcon)}</span>
                        <span class="menu-text">${menu.menuName}</span>
                    </a>
                </li>
            `).join('');

        }

        // ë©”ë‰´ ì•„ì´ì½˜ ë§¤í•‘
        function getMenuIcon(iconName) {
            const iconMap = {
                'dashboard': 'ğŸ“Š',
                'content_copy': 'ğŸ“„',
                'people': 'ğŸ‘¥',
                'settings': 'âš™ï¸',
                'announcement': 'ğŸ“¢',
                'newspaper': 'ğŸ“°',
                'menu': 'ğŸ“‹',
                'admin_panel_settings': 'ğŸ‘¤',
                'tune': 'ğŸ›ï¸',
                'history': 'ğŸ“œ'
            };
            return iconMap[iconName] || 'ğŸ“';
        }

        // ë©”ë‰´ ì˜¤ë¥˜ í‘œì‹œ
        function showMenuError(message) {
            const menuContainer = document.getElementById('sidebarMenu');
            if (menuContainer) {
                menuContainer.innerHTML = `<li class="loading">${message}</li>`;
            }
        }

        // ì‚¬ì´ë“œë°” ì´ë²¤íŠ¸ ì„¤ì •
        function setupSidebarEvents() {
            // ì‚¬ì´ë“œë°” í† ê¸€ ì´ë²¤íŠ¸
            const toggleBtn = document.querySelector('.sidebar-toggle');
            if (toggleBtn) {
                toggleBtn.addEventListener('click', function() {
                    const sidebar = document.getElementById('adminSidebar');
                    const mainContent = document.querySelector('.main-content');
                    
                    if (sidebar && mainContent) {
                        sidebar.classList.toggle('collapsed');
                        mainContent.classList.toggle('sidebar-collapsed');
                    }
                });
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‚¬ì´ë“œë°” ë¡œë“œ
        document.addEventListener('DOMContentLoaded', function() {
            loadAdminSidebar();
        });
    </script>
            </div>
        </main>
    </div>
</body>
</html>
